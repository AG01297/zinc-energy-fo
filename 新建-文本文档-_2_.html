<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”Œèƒ½æº æœåŠ¡å™¨è®ºå›</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* å…¨å±€æ ·å¼é‡ç½®ä¸åŸºç¡€é…ç½® */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft Yahei', Arial, sans-serif;
        }

        :root {
            /* äº®è‰²ä¸»é¢˜å˜é‡ */
            --primary-color: #165DFF;
            --primary-light: #4080FF;
            --primary-dark: #0E42C7;
            --text-main: #333;
            --text-secondary: #666;
            --text-placeholder: #999;
            --bg-main: #F5F7FA;
            --bg-card: #FFFFFF;
            --border-light: #E5E6EB;
            --border-dark: #D0D3D9;
            --success-color: #00B42A;
            --error-color: #F53F3F;
            --warning-color: #FF7D00;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        /* æš—è‰²ä¸»é¢˜å˜é‡ */
        :root.dark-mode {
            --primary-color: #4080FF;
            --primary-light: #69A1FF;
            --primary-dark: #2766E6;
            --text-main: #E5E6EB;
            --text-secondary: #AAB0B6;
            --text-placeholder: #868A90;
            --bg-main: #1D1E20;
            --bg-card: #2D2E30;
            --border-light: #3D3E40;
            --border-dark: #4D4E50;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            transition: var(--transition);
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 999;
        }

        header h1 {
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        header h1 i {
            font-size: 20px;
        }

        .server-ip {
            font-size: 14px;
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            margin-right: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 1000;
            cursor: pointer; /* å¢åŠ é¼ æ ‡æŒ‡é’ˆæ ·å¼ */
            transition: var(--transition);
        }

        /* æ–°å¢ï¼šIP hover æ•ˆæœ */
        .server-ip:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* æ–°å¢ï¼šå¤åˆ¶æˆåŠŸæç¤ºæ ·å¼ */
        .copy-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-color);
            color: white;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateX(-50%) translateY(-20px);
        }

        .copy-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        header #user-info {
            font-size: 14px;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            margin-right: 8px;
            z-index: 1000;
        }

        /* æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        #logout-btn, #reset-btn, #login-btn, #theme-toggle {
            font-size: 12px;
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-left: 8px;
            border-radius: var(--radius-sm);
            color: white;
            cursor: pointer;
            z-index: 1001;
            transition: var(--transition);
            pointer-events: auto;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        #logout-btn {
            background: rgba(245, 63, 63, 0.2);
        }
        #logout-btn:hover {
            background: rgba(245, 63, 63, 0.4);
        }

        #reset-btn {
            background: rgba(255, 125, 0, 0.2);
        }
        #reset-btn:hover {
            background: rgba(255, 125, 0, 0.4);
        }

        #login-btn {
            background: rgba(0, 180, 42, 0.2);
        }
        #login-btn:hover {
            background: rgba(0, 180, 42, 0.4);
        }

        #theme-toggle {
            background: rgba(22, 93, 255, 0.2);
        }
        #theme-toggle:hover {
            background: rgba(22, 93, 255, 0.4);
        }

        .header-right {
            display: flex;
            align-items: center;
            z-index: 1000;
            position: relative;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        .top-menu {
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 998;
        }

        .menu-links {
            display: flex;
        }

        .menu-links a {
            color: var(--text-secondary);
            padding: 16px 20px;
            text-decoration: none;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
            position: relative;
        }

        .menu-links a:hover {
            color: var(--primary-color);
            background-color: rgba(22, 93, 255, 0.05);
        }

        .menu-links a.active {
            color: var(--primary-color);
        }

        .menu-links a.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
        }

        .auth-button-container {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        /* ä¸»å†…å®¹åŒº */
        .content {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .content h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .content h2 i {
            font-size: 16px;
        }

        /* è¡¨å•é€šç”¨æ ·å¼ */
        form {
            margin-top: 20px;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea,
        input[type="file"] {
            width: 100%;
            padding: 10px 12px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background-color: var(--bg-card);
            color: var(--text-main);
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(22, 93, 255, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.5;
        }

        ::placeholder {
            color: var(--text-placeholder);
            font-size: 14px;
        }

        /* æŒ‰é’®é€šç”¨æ ·å¼ */
        .btn {
            padding: 10px 18px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background-color: var(--primary-light);
        }

        .btn:active {
            background-color: var(--primary-dark);
        }

        .btn:disabled {
            background-color: var(--border-light);
            color: var(--text-placeholder);
            cursor: not-allowed;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger {
            background-color: var(--error-color);
        }
        .btn-danger:hover {
            background-color: #E03535;
        }

        /* æ¶ˆæ¯é¢æ¿æ ·å¼ */
        .message-board {
            margin-top: 20px;
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }

        .message-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .message-item:hover {
            background-color: rgba(22, 93, 255, 0.03);
            padding-left: 20px;
        }

        .message-item:last-child {
            border-bottom: none;
        }

        .message-content {
            flex: 1;
        }

        .message-meta {
            font-size: 12px;
            color: var(--text-placeholder);
            margin-bottom: 4px;
        }

        .message-actions {
            margin-left: 16px;
        }

        /* é”™è¯¯/æˆåŠŸæç¤º - ä¼˜åŒ–åŠ¨ç”» */
        .error-message {
            color: var(--error-color);
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            opacity: 0;
            transform: translateY(5px);
            transition: all 0.3s ease;
            height: 16px;
        }

        .error-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .success-tip {
            color: var(--success-color);
            font-size: 14px;
            margin-top: 10px;
            display: none;
            padding: 8px 12px;
            background-color: rgba(0, 180, 42, 0.08);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--success-color);
            animation: fadeInOut 3s ease;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(10px); }
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            padding-top: 80px;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: var(--bg-card);
            margin: 0 auto;
            padding: 24px;
            border: 1px solid var(--border-light);
            width: 90%;
            max-width: 420px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-dark);
            text-align: center;
        }

        .close {
            color: var(--text-placeholder);
            float: right;
            font-size: 20px;
            font-weight: bold;
            transition: var(--transition);
        }

        .close:hover,
        .close:focus {
            color: var(--error-color);
            text-decoration: none;
            cursor: pointer;
        }

        /* æ–‡ä»¶åˆ—è¡¨æ ·å¼ */
        .file-list {
            margin-top: 20px;
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }

        .file-list h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .file-item:hover {
            background-color: rgba(22, 93, 255, 0.05);
            transform: translateY(-2px);
        }

        .file-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .file-info {
            font-size: 14px;
            color: var(--text-main);
        }

        .file-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-meta {
            font-size: 12px;
            color: var(--text-placeholder);
            margin-top: 4px;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .download-btn {
            padding: 6px 12px;
            background-color: var(--primary-light);
            font-size: 12px;
        }

        .upload-area {
            margin-top: 10px;
            padding: 16px;
            background-color: rgba(22, 93, 255, 0.05);
            border: 1px dashed var(--primary-light);
            border-radius: var(--radius-md);
            transition: var(--transition);
        }

        .upload-area:hover {
            background-color: rgba(22, 93, 255, 0.08);
        }

        .upload-area p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .upload-limit {
            font-size: 12px;
            color: var(--text-placeholder);
            margin-top: 8px;
        }

        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .page-btn {
            padding: 6px 12px;
            background-color: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* æ•°æ®å¤‡ä»½åŒºåŸŸ */
        .backup-area {
            margin-top: 20px;
            padding: 16px;
            background-color: rgba(0, 180, 42, 0.05);
            border: 1px solid var(--success-color);
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .backup-info {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            header {
                padding: 12px 16px;
            }

            header h1 {
                font-size: 18px;
            }

            .server-ip {
                font-size: 12px;
                padding: 3px 8px;
                margin-right: 8px;
            }

            header #user-info {
                font-size: 12px;
                padding: 3px 8px;
                margin-right: 4px;
            }

            #logout-btn, #reset-btn, #login-btn, #theme-toggle {
                font-size: 10px;
                padding: 4px 8px;
                margin-left: 4px;
            }

            .top-menu {
                padding: 0 16px;
            }

            .menu-links a {
                padding: 16px 12px;
                font-size: 13px;
            }

            .content {
                padding: 16px;
            }

            .message-board, .file-list {
                padding: 16px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .file-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .file-actions {
                margin-top: 12px;
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 480px) {
            .header-right {
                flex-direction: column;
                align-items: flex-end;
                gap: 4px;
            }
            .server-ip {
                margin-right: 0;
            }
            header #user-info {
                margin-right: 0;
            }
            #logout-btn, #reset-btn, #login-btn, #theme-toggle {
                margin-left: 0;
                align-self: flex-end;
            }

            .auth-button-container {
                flex-direction: column;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-server"></i> é”Œèƒ½æº</h1>
        <div class="header-right">
            <div class="server-ip"><i class="fas fa-globe"></i> zincserver.cn</div>
            <p id="user-info"></p>
            <button id="login-btn"><i class="fas fa-sign-in-alt"></i> ç™»å½•</button>
            <button id="register-btn"><i class="fas fa-user-plus"></i> æ³¨å†Œ</button>
            <button id="logout-btn" style="display: none;"><i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•</button>
            <button id="reset-btn" style="display: none;"><i class="fas fa-undo"></i> é‡ç½®æ•°æ®</button>
            <button id="theme-toggle"><i class="fas fa-moon"></i> æš—è‰²æ¨¡å¼</button>
        </div>
    </header>
    <div class="top-menu">
        <div class="menu-links">
            <a href="#" id="official-messages" class="active"><i class="fas fa-bullhorn"></i> å®˜æ–¹æ¶ˆæ¯</a>
            <a href="#" id="player-discussion"><i class="fas fa-comments"></i> ç©å®¶è®¨è®º</a>
            <a href="#" id="shared-blueprints"><i class="fas fa-share-alt-square"></i> å…±äº«è“å›¾</a>
        </div>
    </div>
    <div class="content">
        <!-- å®˜æ–¹æ¶ˆæ¯æ¿å— -->
        <div id="official-messages-section" style="display:block;">
            <h2><i class="fas fa-bullhorn"></i> å®˜æ–¹æ¶ˆæ¯</h2>
            <div class="message-board" id="official-messages-board"></div>
            <div class="pagination" id="official-pagination"></div>
            <form id="send-message-form-official" style="display:none; margin-top:20px;">
                <textarea placeholder="è¾“å…¥å®˜æ–¹æ¶ˆæ¯å†…å®¹..." id="message-input-official"></textarea>
                <div style="margin-top:10px;">
                    <label for="admin-key" style="font-size:14px; color:var(--text-secondary);">ç®¡ç†å‘˜å¯†é’¥ï¼š</label>
                    <input type="password" id="admin-key" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†é’¥">
                    <div id="admin-key-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                </div>
                <button type="submit" class="btn" style="margin-top:10px;"><i class="fas fa-paper-plane"></i> å‘é€æ¶ˆæ¯</button>
            </form>
        </div>

        <!-- ç©å®¶è®¨è®ºæ¿å— -->
        <div id="player-discussion-section" style="display:none;">
            <h2><i class="fas fa-comments"></i> ç©å®¶è®¨è®º</h2>
            <div class="message-board" id="player-discussion-board"></div>
            <div class="pagination" id="player-pagination"></div>
            <form id="send-message-form-player" style="display:none; margin-top:20px;">
                <textarea placeholder="åˆ†äº«ä½ çš„æƒ³æ³•å’Œç»éªŒ..." id="message-input-player"></textarea>
                <button type="submit" class="btn"><i class="fas fa-paper-plane"></i> å‘é€æ¶ˆæ¯</button>
                <div class="success-tip" id="player-message-tip"><i class="fas fa-check-circle"></i> æ¶ˆæ¯å‘é€æˆåŠŸï¼</div>
            </form>
        </div>

        <!-- å…±äº«è“å›¾æ¿å— -->
        <div id="shared-blueprints-section" style="display:none;">
            <h2><i class="fas fa-share-alt-square"></i> å…±äº«è“å›¾</h2>
            <div class="upload-area">
                <p><i class="fas fa-info-circle"></i> åœ¨è¿™é‡Œä¸Šä¼ ä½ çš„NBTæ ¼å¼è“å›¾æ–‡ä»¶ï¼Œä¸æœåŠ¡å™¨ç©å®¶å…±äº«ï¼ˆæ‰€æœ‰ç”¨æˆ·å‡å¯ä¸‹è½½ï¼‰ï¼š</p>
                <input type="file" accept=".nbt" id="nbt-file-upload" />
                <div class="upload-limit"><i class="fas fa-exclamation-circle"></i> æ¸©é¦¨æç¤ºï¼šæ–‡ä»¶å¤§å°é™åˆ¶1MBä»¥å†…</div>
                <div class="success-tip" id="upload-tip"><i class="fas fa-check-circle"></i> æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ‰€æœ‰ç”¨æˆ·å‡å¯ä¸‹è½½</div>
            </div>
            <div class="file-list" id="file-list">
                <h3><i class="fas fa-folder-open"></i> å…±äº«è“å›¾æ–‡ä»¶åˆ—è¡¨</h3>
                <div id="uploaded-files-container"></div>
                <div class="pagination" id="file-pagination"></div>
            </div>

            <!-- æ•°æ®å¤‡ä»½åŒºåŸŸ -->
            <div class="backup-area">
                <div class="backup-info">
                    <i class="fas fa-shield-alt"></i> æ•°æ®å¤‡ä»½/æ¢å¤ï¼ˆæœ¬åœ°å­˜å‚¨ï¼Œä»…å½“å‰è®¾å¤‡å¯ç”¨ï¼‰
                </div>
                <div>
                    <button id="export-data" class="btn btn-sm"><i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®</button>
                    <input type="file" id="import-data" accept=".json" style="display:none;" />
                    <label for="import-data" class="btn btn-sm btn-danger"><i class="fas fa-upload"></i> å¯¼å…¥æ•°æ®</label>
                </div>
            </div>
        </div>
    </div>

    <!-- æ³¨å†Œå¼¹çª— -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3><i class="fas fa-user-plus"></i> ç”¨æˆ·æ³¨å†Œ</h3>
            <form id="register-form">
                <label for="reg-username" style="font-size:14px; color:var(--text-secondary);">æ¸¸æˆID:</label>
                <input type="text" id="reg-username" required placeholder="è¯·è¾“å…¥ä½ çš„æ¸¸æˆID">
                <div id="reg-username-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                
                <label for="reg-email" style="font-size:14px; color:var(--text-secondary);">é‚®ç®±åœ°å€:</label>
                <input type="email" id="reg-email" required placeholder="è¯·è¾“å…¥ä½ çš„é‚®ç®±">
                <div id="reg-email-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                
                <label for="reg-password" style="font-size:14px; color:var(--text-secondary);">å¯†ç :</label>
                <input type="password" id="reg-password" required placeholder="å¯†ç é•¿åº¦ä¸å°‘äº6ä½">
                <div id="reg-password-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                
                <label for="reg-confirm-password" style="font-size:14px; color:var(--text-secondary);">ç¡®è®¤å¯†ç :</label>
                <input type="password" id="reg-confirm-password" required placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                <div id="reg-confirm-password-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                
                <div style="margin-top:20px; text-align:center;">
                    <button type="submit" class="btn"><i class="fas fa-check"></i> å®Œæˆæ³¨å†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3><i class="fas fa-sign-in-alt"></i> ç”¨æˆ·ç™»å½•</h3>
            <form id="login-form">
                <label for="login-username" style="font-size:14px; color:var(--text-secondary);">æ¸¸æˆID:</label>
                <input type="text" id="login-username" required placeholder="è¯·è¾“å…¥ä½ çš„æ¸¸æˆID">
                <div id="login-username-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                
                <label for="login-password" style="font-size:14px; color:var(--text-secondary);">å¯†ç :</label>
                <input type="password" id="login-password" required placeholder="è¯·è¾“å…¥ä½ çš„å¯†ç ">
                <div id="login-password-error" class="error-message"><i class="fas fa-exclamation-circle"></i></div>
                
                <div style="margin-top:20px; text-align:center;">
                    <button type="submit" class="btn"><i class="fas fa-sign-in-alt"></i> ç™»å½•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ–°å¢ï¼šå¤åˆ¶æˆåŠŸæç¤ºæ¡† -->
    <div class="copy-toast" id="copyToast">
        <i class="fas fa-check-circle"></i> IPå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼
    </div>

    <script>
        // è°ƒè¯•å¼€å…³
        const DEBUG = true;
        function log(msg) {
            if (DEBUG) console.log('[é”Œèƒ½æºè®ºå›]', msg);
        }

        // å¸¸é‡é…ç½®
        const CONFIG = {
            ADMIN_KEY: 'zinc_energy_admin_2024', // ç®¡ç†å‘˜å¯†é’¥ï¼ˆå¯ä¿®æ”¹ï¼‰
            FILE_MAX_SIZE: 1 * 1024 * 1024, // 1MB æ–‡ä»¶å¤§å°é™åˆ¶
            PAGE_SIZE: 10, // æ¯é¡µæ˜¾ç¤ºæ•°é‡
            ENCRYPT_SALT: 'zinc_energy_salt_165dff', // å¯†ç åŠ å¯†ç›å€¼
            SERVER_IP: 'zincserver.cn' // æœåŠ¡å™¨IPå¸¸é‡
        };

        // DOMå…ƒç´ ç¼“å­˜ï¼ˆé¿å…é‡å¤æŸ¥è¯¢ï¼‰
        const DOM = {
            // æ–°å¢ï¼šIPå…ƒç´ å’Œå¤åˆ¶æç¤º
            serverIp: document.querySelector('.server-ip'),
            copyToast: document.getElementById('copyToast'),
            
            // å¼¹çª—ç›¸å…³
            registerModal: document.getElementById('registerModal'),
            loginModal: document.getElementById('loginModal'),
            closeBtns: document.querySelectorAll('.close'),
            
            // æŒ‰é’®ç›¸å…³
            registerBtn: document.getElementById('register-btn'),
            loginBtn: document.getElementById('login-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            resetBtn: document.getElementById('reset-btn'),
            themeToggle: document.getElementById('theme-toggle'),
            exportDataBtn: document.getElementById('export-data'),
            importDataBtn: document.getElementById('import-data'),
            
            // è¡¨å•ç›¸å…³
            registerForm: document.getElementById('register-form'),
            loginForm: document.getElementById('login-form'),
            officialMsgForm: document.getElementById('send-message-form-official'),
            playerMsgForm: document.getElementById('send-message-form-player'),
            
            // å†…å®¹åŒºåŸŸ
            officialMsgBoard: document.getElementById('official-messages-board'),
            playerMsgBoard: document.getElementById('player-discussion-board'),
            uploadedFilesContainer: document.getElementById('uploaded-files-container'),
            
            // åˆ†é¡µåŒºåŸŸ
            officialPagination: document.getElementById('official-pagination'),
            playerPagination: document.getElementById('player-pagination'),
            filePagination: document.getElementById('file-pagination'),
            
            // å…¶ä»–
            userInfo: document.getElementById('user-info'),
            nbtFileUpload: document.getElementById('nbt-file-upload'),
            uploadTip: document.getElementById('upload-tip'),
            playerMsgTip: document.getElementById('player-message-tip'),
            adminKeyInput: document.getElementById('admin-key'),
            adminKeyError: document.getElementById('admin-key-error')
        };

        // æ•°æ®å­˜å‚¨ï¼ˆåˆå§‹åŒ–ï¼‰
        let DATA = {
            userData: JSON.parse(localStorage.getItem('zincEnergyUserData') || '{}'), // ç”¨æˆ·æ•°æ®ï¼ˆå«å¯†ç ï¼‰
            currentUser: localStorage.getItem('zincEnergyCurrentUser') || null, // å½“å‰ç™»å½•ç”¨æˆ·
            officialMessages: JSON.parse(localStorage.getItem('zincEnergyOfficialMessages') || '[]'),
            playerMessages: JSON.parse(localStorage.getItem('zincEnergyPlayerMessages') || '[]'),
            uploadedFiles: JSON.parse(localStorage.getItem('zincEnergyUploadedFiles') || '[]'),
            theme: localStorage.getItem('zincEnergyTheme') || 'light' // ä¸»é¢˜æ¨¡å¼
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–');
            
            // åˆå§‹åŒ–ä¸»é¢˜
            initTheme();
            
            // åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€
            initUserState();
            
            // åˆå§‹åŒ–å†…å®¹ï¼ˆæ¶ˆæ¯ã€æ–‡ä»¶ï¼‰
            renderOfficialMessages(1);
            renderPlayerMessages(1);
            renderFiles(1);
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            log('åˆå§‹åŒ–å®Œæˆ');
        });

        // ä¸»é¢˜åˆ‡æ¢åˆå§‹åŒ–
        function initTheme() {
            if (DATA.theme === 'dark') {
                document.documentElement.classList.add('dark-mode');
                DOM.themeToggle.innerHTML = '<i class="fas fa-sun"></i> äº®è‰²æ¨¡å¼';
            } else {
                document.documentElement.classList.remove('dark-mode');
                DOM.themeToggle.innerHTML = '<i class="fas fa-moon"></i> æš—è‰²æ¨¡å¼';
            }
        }

        // ç”¨æˆ·çŠ¶æ€åˆå§‹åŒ–
        function initUserState() {
            log('æ›´æ–°ç”¨æˆ·çŠ¶æ€ï¼š', DATA.currentUser);
            if (DATA.currentUser) {
                // å·²ç™»å½•
                DOM.userInfo.textContent = `å½“å‰ç™»å½•ï¼š${DATA.currentUser}`;
                DOM.registerBtn.style.display = 'none';
                DOM.loginBtn.style.display = 'none';
                DOM.logoutBtn.style.display = 'inline-flex';
                DOM.resetBtn.style.display = 'inline-flex';
            } else {
                // æœªç™»å½•
                DOM.userInfo.textContent = '';
                DOM.registerBtn.style.display = 'inline-flex';
                DOM.loginBtn.style.display = 'inline-flex';
                DOM.logoutBtn.style.display = 'none';
                DOM.resetBtn.style.display = 'none';
            }
            // æ›´æ–°è¡¨å•å¯è§æ€§
            updateFormVisibility(document.querySelector('.menu-links a.active').id + '-section');
        }

        // ç»‘å®šæ‰€æœ‰äº‹ä»¶
        function bindEvents() {
            // æ–°å¢ï¼šIPå¤åˆ¶äº‹ä»¶
            DOM.serverIp.addEventListener('click', copyServerIp);

            // å¼¹çª—å…³é—­äº‹ä»¶
            DOM.closeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    DOM.registerModal.style.display = 'none';
                    DOM.loginModal.style.display = 'none';
                });
            });

            // ç‚¹å‡»ç©ºç™½å¤„å…³é—­å¼¹çª—
            window.addEventListener('click', function(e) {
                if (e.target === DOM.registerModal) DOM.registerModal.style.display = 'none';
                if (e.target === DOM.loginModal) DOM.loginModal.style.display = 'none';
            });

            // æ³¨å†Œ/ç™»å½•æŒ‰é’®äº‹ä»¶
            DOM.registerBtn.addEventListener('click', () => {
                DOM.registerModal.style.display = 'block';
                clearFormErrors('register');
            });
            DOM.loginBtn.addEventListener('click', () => {
                DOM.loginModal.style.display = 'block';
                clearFormErrors('login');
            });

            // ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
            DOM.themeToggle.addEventListener('click', function() {
                if (DATA.theme === 'light') {
                    DATA.theme = 'dark';
                    document.documentElement.classList.add('dark-mode');
                    this.innerHTML = '<i class="fas fa-sun"></i> äº®è‰²æ¨¡å¼';
                } else {
                    DATA.theme = 'light';
                    document.documentElement.classList.remove('dark-mode');
                    this.innerHTML = '<i class="fas fa-moon"></i> æš—è‰²æ¨¡å¼';
                }
                localStorage.setItem('zincEnergyTheme', DATA.theme);
            });

            // æ³¨å†Œè¡¨å•æäº¤
            DOM.registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                clearFormErrors('register');
                
                const username = document.getElementById('reg-username').value.trim();
                const email = document.getElementById('reg-email').value.trim();
                const password = document.getElementById('reg-password').value;
                const confirmPassword = document.getElementById('reg-confirm-password').value;
                
                let isValid = true;
                
                // éªŒè¯é€»è¾‘
                if (!username) {
                    showError('reg-username-error', 'è¯·å¡«å†™æ¸¸æˆID');
                    isValid = false;
                } else if (DATA.userData[username]) {
                    showError('reg-username-error', 'è¯¥æ¸¸æˆIDå·²è¢«æ³¨å†Œ');
                    isValid = false;
                }
                
                if (!email) {
                    showError('reg-email-error', 'è¯·å¡«å†™é‚®ç®±');
                    isValid = false;
                } else if (!/^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(email)) {
                    showError('reg-email-error', 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
                    isValid = false;
                }
                
                if (!password || password.length < 6) {
                    showError('reg-password-error', 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½');
                    isValid = false;
                }
                
                if (password !== confirmPassword) {
                    showError('reg-confirm-password-error', 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´');
                    isValid = false;
                }

                if (!isValid) return;

                // å¯†ç åŠ å¯†å­˜å‚¨
                DATA.userData[username] = {
                    email: email,
                    password: encryptPassword(password),
                    registerTime: new Date().getTime()
                };
                
                // ä¿å­˜æ•°æ®
                localStorage.setItem('zincEnergyUserData', JSON.stringify(DATA.userData));
                DATA.currentUser = username;
                localStorage.setItem('zincEnergyCurrentUser', username);
                
                // å…³é—­å¼¹çª—å¹¶æ›´æ–°çŠ¶æ€
                DOM.registerModal.style.display = 'none';
                alert('æ³¨å†ŒæˆåŠŸï¼å·²è‡ªåŠ¨ç™»å½•');
                initUserState();
                log('ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼š', username);
            });

            // ç™»å½•è¡¨å•æäº¤
            DOM.loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                clearFormErrors('login');
                
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                
                let isValid = true;
                
                if (!username) {
                    showError('login-username-error', 'è¯·å¡«å†™æ¸¸æˆID');
                    isValid = false;
                }
                
                if (!password) {
                    showError('login-password-error', 'è¯·å¡«å†™å¯†ç ');
                    isValid = false;
                }

                if (!isValid) return;

                // éªŒè¯ç”¨æˆ·å’Œå¯†ç 
                const user = DATA.userData[username];
                if (!user) {
                    showError('login-username-error', 'è¯¥ç”¨æˆ·æœªæ³¨å†Œ');
                    return;
                }
                
                if (user.password !== encryptPassword(password)) {
                    showError('login-password-error', 'å¯†ç é”™è¯¯');
                    return;
                }

                // ç™»å½•æˆåŠŸ
                DATA.currentUser = username;
                localStorage.setItem('zincEnergyCurrentUser', username);
                
                DOM.loginModal.style.display = 'none';
                alert('ç™»å½•æˆåŠŸï¼');
                initUserState();
                log('ç”¨æˆ·ç™»å½•æˆåŠŸï¼š', username);
            });

            // é€€å‡ºç™»å½•
            DOM.logoutBtn.addEventListener('click', function() {
                if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) return;
                
                DATA.currentUser = null;
                localStorage.removeItem('zincEnergyCurrentUser');
                initUserState();
                alert('å·²æˆåŠŸé€€å‡ºç™»å½•ï¼');
                log('ç”¨æˆ·é€€å‡ºç™»å½•');
            });

            // é‡ç½®æ•°æ®
            DOM.resetBtn.addEventListener('click', function() {
                if (!confirm('âš ï¸ è­¦å‘Šï¼æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆç”¨æˆ·ã€æ¶ˆæ¯ã€æ–‡ä»¶ï¼‰ï¼Œä¸”æ— æ³•æ¢å¤ï¼ç¡®å®šé‡ç½®ï¼Ÿ')) return;
                if (!confirm('ğŸ”´ æœ€ç»ˆç¡®è®¤ï¼ç‚¹å‡»ç¡®å®šåæ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ï¼ç¡®å®šï¼Ÿ')) return;
                
                // æ¸…ç©ºæ‰€æœ‰å­˜å‚¨
                localStorage.removeItem('zincEnergyUserData');
                localStorage.removeItem('zincEnergyCurrentUser');
                localStorage.removeItem('zincEnergyOfficialMessages');
                localStorage.removeItem('zincEnergyPlayerMessages');
                localStorage.removeItem('zincEnergyUploadedFiles');
                
                // é‡ç½®æ•°æ®
                DATA = {
                    userData: {},
                    currentUser: null,
                    officialMessages: [],
                    playerMessages: [],
                    uploadedFiles: [],
                    theme: DATA.theme
                };
                
                // æ›´æ–°ç•Œé¢
                initUserState();
                renderOfficialMessages(1);
                renderPlayerMessages(1);
                renderFiles(1);
                alert('âœ… æ‰€æœ‰æ•°æ®å·²é‡ç½®ï¼');
                log('æ‰€æœ‰æ•°æ®å·²é‡ç½®');
            });

            // å®˜æ–¹æ¶ˆæ¯å‘é€
            DOM.officialMsgForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (!DATA.currentUser) {
                    alert('è¯·å…ˆç™»å½•ï¼');
                    return;
                }
                
                const adminKey = DOM.adminKeyInput.value.trim();
                const msgContent = document.getElementById('message-input-official').value.trim();
                
                if (!adminKey) {
                    showError('admin-key-error', 'è¯·è¾“å…¥ç®¡ç†å‘˜å¯†é’¥');
                    return;
                }
                
                if (adminKey !== CONFIG.ADMIN_KEY) {
                    showError('admin-key-error', 'ç®¡ç†å‘˜å¯†é’¥é”™è¯¯');
                    return;
                }
                
                if (!msgContent) {
                    alert('æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                    return;
                }
                
                // æ–°å¢æ¶ˆæ¯ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
                const newMsg = {
                    content: msgContent,
                    author: DATA.currentUser,
                    timestamp: new Date().getTime(),
                    id: generateId()
                };
                
                DATA.officialMessages.unshift(newMsg);
                saveData('officialMessages');
                renderOfficialMessages(1);
                
                // æ¸…ç©ºè¾“å…¥
                document.getElementById('message-input-official').value = '';
                DOM.adminKeyInput.value = '';
                DOM.adminKeyError.classList.remove('show');
                log('å®˜æ–¹æ¶ˆæ¯å‘é€æˆåŠŸï¼š', newMsg);
            });

            // ç©å®¶æ¶ˆæ¯å‘é€
            DOM.playerMsgForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (!DATA.currentUser) {
                    alert('è¯·å…ˆç™»å½•ï¼');
                    return;
                }
                
                const msgContent = document.getElementById('message-input-player').value.trim();
                if (!msgContent) {
                    alert('æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                    return;
                }
                
                // æ–°å¢æ¶ˆæ¯ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
                const newMsg = {
                    content: msgContent,
                    author: DATA.currentUser,
                    timestamp: new Date().getTime(),
                    id: generateId()
                };
                
                DATA.playerMessages.unshift(newMsg);
                saveData('playerMessages');
                renderPlayerMessages(1);
                
                // æ¸…ç©ºè¾“å…¥å¹¶æ˜¾ç¤ºæç¤º
                document.getElementById('message-input-player').value = '';
                DOM.playerMsgTip.style.display = 'block';
                setTimeout(() => { DOM.playerMsgTip.style.display = 'none'; }, 3000);
                log('ç©å®¶æ¶ˆæ¯å‘é€æˆåŠŸï¼š', newMsg);
            });

            // æ–‡ä»¶ä¸Šä¼ 
            DOM.nbtFileUpload.addEventListener('change', debounce(function() {
                if (!DATA.currentUser) {
                    alert('è¯·å…ˆç™»å½•åä¸Šä¼ æ–‡ä»¶ï¼');
                    this.value = '';
                    return;
                }
                
                const file = this.files[0];
                if (!file) return;
                
                // éªŒè¯æ–‡ä»¶å¤§å°
                if (file.size > CONFIG.FILE_MAX_SIZE) {
                    alert(`æ–‡ä»¶è¿‡å¤§ï¼è¯·ä¸Šä¼ 1MBä»¥å†…çš„æ–‡ä»¶ï¼ˆå½“å‰æ–‡ä»¶ï¼š${(file.size/1024/1024).toFixed(2)}MBï¼‰`);
                    this.value = '';
                    return;
                }
                
                // è¯»å–æ–‡ä»¶å¹¶å­˜å‚¨
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileInfo = {
                        fileName: file.name,
                        fileSize: file.size,
                        fileData: e.target.result.split(',')[1],
                        uploader: DATA.currentUser,
                        timestamp: new Date().getTime(),
                        id: generateId()
                    };
                    
                    DATA.uploadedFiles.unshift(fileInfo);
                    saveData('uploadedFiles');
                    renderFiles(1);
                    
                    DOM.uploadTip.style.display = 'block';
                    setTimeout(() => { DOM.uploadTip.style.display = 'none'; }, 3000);
                    log('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼š', fileInfo.fileName);
                };
                reader.readAsDataURL(file);
                this.value = '';
            }, 500));

            // æ•°æ®å¯¼å‡º
            DOM.exportDataBtn.addEventListener('click', function() {
                const exportData = {
                    userData: DATA.userData,
                    officialMessages: DATA.officialMessages,
                    playerMessages: DATA.playerMessages,
                    uploadedFiles: DATA.uploadedFiles
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `é”Œèƒ½æºè®ºå›æ•°æ®å¤‡ä»½_${formatTime(new Date().getTime())}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log('æ•°æ®å¯¼å‡ºæˆåŠŸ');
            });

            // æ•°æ®å¯¼å…¥
            DOM.importDataBtn.addEventListener('change', function() {
                const file = this.files[0];
                if (!file) return;
                
                if (!confirm('âš ï¸ å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œä¸”æ— æ³•æ¢å¤ï¼ç¡®å®šå¯¼å…¥ï¼Ÿ')) {
                    this.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        // éªŒè¯æ•°æ®æ ¼å¼
                        if (!importData.userData || !importData.officialMessages || !importData.playerMessages || !importData.uploadedFiles) {
                            throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                        
                        // è¦†ç›–æ•°æ®
                        DATA.userData = importData.userData;
                        DATA.officialMessages = importData.officialMessages;
                        DATA.playerMessages = importData.playerMessages;
                        DATA.uploadedFiles = importData.uploadedFiles;
                        
                        // ä¿å­˜æ•°æ®
                        saveData('userData');
                        saveData('officialMessages');
                        saveData('playerMessages');
                        saveData('uploadedFiles');
                        
                        // æ›´æ–°ç•Œé¢
                        renderOfficialMessages(1);
                        renderPlayerMessages(1);
                        renderFiles(1);
                        
                        alert('âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                        log('æ•°æ®å¯¼å…¥æˆåŠŸ');
                    } catch (err) {
                        alert('âŒ æ•°æ®å¯¼å…¥å¤±è´¥ï¼š' + err.message);
                        log('æ•°æ®å¯¼å…¥å¤±è´¥ï¼š', err);
                    }
                };
                reader.readAsText(file);
                this.value = '';
            });

            // æ¿å—åˆ‡æ¢
            document.querySelectorAll('.menu-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.menu-links a').forEach(el => el.classList.remove('active'));
                    this.classList.add('active');
                    
                    // éšè—æ‰€æœ‰æ¿å—
                    document.querySelectorAll('.content > div[id$="-section"]').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // æ˜¾ç¤ºç›®æ ‡æ¿å—
                    const targetId = this.id + '-section';
                    document.getElementById(targetId).style.display = 'block';
                    updateFormVisibility(targetId);
                });
            });

            // è¾“å…¥æ¡†å®æ—¶æ¸…é™¤é”™è¯¯
            document.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('input', function() {
                    const errorId = this.id + '-error';
                    const errorEl = document.getElementById(errorId);
                    if (errorEl) errorEl.classList.remove('show');
                });
            });
        }

        // æ–°å¢ï¼šå¤åˆ¶æœåŠ¡å™¨IPå‡½æ•°
        function copyServerIp() {
            try {
                // ä½¿ç”¨å‰ªè´´æ¿APIå¤åˆ¶IP
                navigator.clipboard.writeText(CONFIG.SERVER_IP).then(() => {
                    // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                    showCopyToast();
                    log(`IPå¤åˆ¶æˆåŠŸï¼š${CONFIG.SERVER_IP}`);
                }).catch(err => {
                    // é™çº§æ–¹æ¡ˆï¼šåˆ›å»ºä¸´æ—¶è¾“å…¥æ¡†å¤åˆ¶
                    const tempInput = document.createElement('input');
                    tempInput.value = CONFIG.SERVER_IP;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showCopyToast();
                    log(`IPå¤åˆ¶æˆåŠŸï¼ˆé™çº§æ–¹æ¡ˆï¼‰ï¼š${CONFIG.SERVER_IP}`);
                });
            } catch (err) {
                alert('IPå¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š' + CONFIG.SERVER_IP);
                log('IPå¤åˆ¶å¤±è´¥ï¼š', err);
            }
        }

        // æ–°å¢ï¼šæ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
        function showCopyToast() {
            DOM.copyToast.classList.add('show');
            setTimeout(() => {
                DOM.copyToast.classList.remove('show');
            }, 2000);
        }

        // æ¸²æŸ“å®˜æ–¹æ¶ˆæ¯ï¼ˆå¸¦åˆ†é¡µï¼‰
        function renderOfficialMessages(page = 1) {
            const total = DATA.officialMessages.length;
            const totalPages = Math.ceil(total / CONFIG.PAGE_SIZE);
            const start = (page - 1) * CONFIG.PAGE_SIZE;
            const end = start + CONFIG.PAGE_SIZE;
            const messages = DATA.officialMessages.slice(start, end);
            
            // æ¸…ç©ºå®¹å™¨
            DOM.officialMsgBoard.innerHTML = '';
            
            if (messages.length === 0) {
                DOM.officialMsgBoard.innerHTML = `
                    <div style="text-align:center; padding:30px; color:var(--text-placeholder);">
                        <i class="fas fa-bullhorn" style="font-size:48px; margin-bottom:12px;"></i>
                        <p>æš‚æ— å®˜æ–¹æ¶ˆæ¯</p>
                    </div>
                `;
            } else {
                messages.forEach(msg => {
                    const msgItem = document.createElement('div');
                    msgItem.className = 'message-item';
                    msgItem.innerHTML = `
                        <div class="message-content">
                            <div class="message-meta">
                                <span>${msg.author} (å®˜æ–¹)</span> Â· <span>${formatTime(msg.timestamp)}</span>
                            </div>
                            <div>${msg.content}</div>
                        </div>
                        ${DATA.currentUser === msg.author || DATA.currentUser === 'weiqi_wq' ? `
                            <div class="message-actions">
                                <button class="btn btn-sm btn-danger delete-msg" data-type="official" data-id="${msg.id}">
                                    <i class="fas fa-trash"></i> åˆ é™¤
                                </button>
                            </div>
                        ` : ''}
                    `;
                    DOM.officialMsgBoard.appendChild(msgItem);
                });
                
                // ç»‘å®šåˆ é™¤äº‹ä»¶
                bindDeleteEvents('official');
            }
            
            // æ¸²æŸ“åˆ†é¡µ
            renderPagination(DOM.officialPagination, page, totalPages, renderOfficialMessages);
        }

        // æ¸²æŸ“ç©å®¶æ¶ˆæ¯ï¼ˆå¸¦åˆ†é¡µï¼‰
        function renderPlayerMessages(page = 1) {
            const total = DATA.playerMessages.length;
            const totalPages = Math.ceil(total / CONFIG.PAGE_SIZE);
            const start = (page - 1) * CONFIG.PAGE_SIZE;
            const end = start + CONFIG.PAGE_SIZE;
            const messages = DATA.playerMessages.slice(start, end);
            
            // æ¸…ç©ºå®¹å™¨
            DOM.playerMsgBoard.innerHTML = '';
            
            if (messages.length === 0) {
                DOM.playerMsgBoard.innerHTML = `
                    <div style="text-align:center; padding:30px; color:var(--text-placeholder);">
                        <i class="fas fa-comments" style="font-size:48px; margin-bottom:12px;"></i>
                        <p>æš‚æ— ç©å®¶è®¨è®ºï¼Œå¿«æ¥åˆ†äº«ä½ çš„æƒ³æ³•å§ï½</p>
                    </div>
                `;
            } else {
                messages.forEach(msg => {
                    const msgItem = document.createElement('div');
                    msgItem.className = 'message-item';
                    msgItem.innerHTML = `
                        <div class="message-content">
                            <div class="message-meta">
                                <span>${msg.author}</span> Â· <span>${formatTime(msg.timestamp)}</span>
                            </div>
                            <div>${msg.content}</div>
                        </div>
                        ${DATA.currentUser === msg.author ? `
                            <div class="message-actions">
                                <button class="btn btn-sm btn-danger delete-msg" data-type="player" data-id="${msg.id}">
                                    <i class="fas fa-trash"></i> åˆ é™¤
                                </button>
                            </div>
                        ` : ''}
                    `;
                    DOM.playerMsgBoard.appendChild(msgItem);
                });
                
                // ç»‘å®šåˆ é™¤äº‹ä»¶
                bindDeleteEvents('player');
            }
            
            // æ¸²æŸ“åˆ†é¡µ
            renderPagination(DOM.playerPagination, page, totalPages, renderPlayerMessages);
        }

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰
        function renderFiles(page = 1) {
            const total = DATA.uploadedFiles.length;
            const totalPages = Math.ceil(total / CONFIG.PAGE_SIZE);
            const start = (page - 1) * CONFIG.PAGE_SIZE;
            const end = start + CONFIG.PAGE_SIZE;
            const files = DATA.uploadedFiles.slice(start, end);
            
            // æ¸…ç©ºå®¹å™¨
            DOM.uploadedFilesContainer.innerHTML = '';
            
            if (files.length === 0) {
                DOM.uploadedFilesContainer.innerHTML = `
                    <div style="text-align:center; padding:30px; color:var(--text-placeholder);">
                        <i class="fas fa-folder-empty" style="font-size:48px; margin-bottom:12px;"></i>
                        <p>æš‚æ— å…±äº«çš„è“å›¾æ–‡ä»¶ï¼Œå¿«æ¥ä¸Šä¼ åˆ†äº«å§ï½</p>
                    </div>
                `;
            } else {
                files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-name">
                                <i class="fas fa-file"></i> ${file.fileName}
                            </div>
                            <div class="file-meta">
                                ä¸Šä¼ è€…ï¼š${file.uploader} Â· ä¸Šä¼ æ—¶é—´ï¼š${formatTime(file.timestamp)} Â· å¤§å°ï¼š${formatFileSize(file.fileSize)}
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn btn-sm download-btn" data-id="${file.id}">
                                <i class="fas fa-download"></i> ä¸‹è½½
                            </button>
                            ${DATA.currentUser === file.uploader ? `
                                <button class="btn btn-sm btn-danger delete-file" data-id="${file.id}">
                                    <i class="fas fa-trash"></i> åˆ é™¤
                                </button>
                            ` : ''}
                        </div>
                    `;
                    DOM.uploadedFilesContainer.appendChild(fileItem);
                });
                
                // ç»‘å®šä¸‹è½½å’Œåˆ é™¤äº‹ä»¶
                bindFileEvents();
            }
            
            // æ¸²æŸ“åˆ†é¡µ
            renderPagination(DOM.filePagination, page, totalPages, renderFiles);
        }

        // æ¸²æŸ“åˆ†é¡µ
        function renderPagination(container, currentPage, totalPages, callback) {
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // ä¸Šä¸€é¡µ
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => callback(currentPage - 1));
            container.appendChild(prevBtn);
            
            // é¡µç æŒ‰é’®ï¼ˆæœ€å¤šæ˜¾ç¤º5ä¸ªï¼‰
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => callback(i));
                container.appendChild(pageBtn);
            }
            
            // ä¸‹ä¸€é¡µ
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => callback(currentPage + 1));
            container.appendChild(nextBtn);
        }

        // ç»‘å®šæ¶ˆæ¯åˆ é™¤äº‹ä»¶
        function bindDeleteEvents(type) {
            document.querySelectorAll(`.delete-msg[data-type="${type}"]`).forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ')) return;
                    
                    if (type === 'official') {
                        DATA.officialMessages = DATA.officialMessages.filter(msg => msg.id !== id);
                        saveData('officialMessages');
                        renderOfficialMessages(1);
                    } else {
                        DATA.playerMessages = DATA.playerMessages.filter(msg => msg.id !== id);
                        saveData('playerMessages');
                        renderPlayerMessages(1);
                    }
                    
                    log(`${type}æ¶ˆæ¯åˆ é™¤æˆåŠŸï¼š`, id);
                });
            });
        }

        // ç»‘å®šæ–‡ä»¶äº‹ä»¶ï¼ˆä¸‹è½½/åˆ é™¤ï¼‰
        function bindFileEvents() {
            // ä¸‹è½½äº‹ä»¶
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const file = DATA.uploadedFiles.find(f => f.id === id);
                    if (!file) return;
                    
                    // è§£ç å¹¶ä¸‹è½½
                    const byteCharacters = atob(file.fileData);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: 'application/octet-stream' });
                    
                    const downloadLink = document.createElement('a');
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = file.fileName;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    URL.revokeObjectURL(downloadLink.href);
                    
                    log('æ–‡ä»¶ä¸‹è½½ï¼š', file.fileName);
                });
            });
            
            // åˆ é™¤äº‹ä»¶
            document.querySelectorAll('.delete-file').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')) return;
                    
                    DATA.uploadedFiles = DATA.uploadedFiles.filter(file => file.id !== id);
                    saveData('uploadedFiles');
                    renderFiles(1);
                    
                    log('æ–‡ä»¶åˆ é™¤æˆåŠŸï¼š', id);
                });
            });
        }

        // æ›´æ–°è¡¨å•å¯è§æ€§
        function updateFormVisibility(targetSectionId) {
            // éšè—æ‰€æœ‰è¡¨å•
            DOM.officialMsgForm.style.display = 'none';
            DOM.playerMsgForm.style.display = 'none';
            
            if (!DATA.currentUser) return;
            
            // å®˜æ–¹æ¶ˆæ¯è¡¨å•ï¼šç®¡ç†å‘˜å¯è§
            if (targetSectionId === 'official-messages-section' && DATA.currentUser === 'weiqi_wq') {
                DOM.officialMsgForm.style.display = 'block';
            }
            
            // ç©å®¶è®¨è®ºè¡¨å•ï¼šæ‰€æœ‰ç™»å½•ç”¨æˆ·å¯è§
            if (targetSectionId === 'player-discussion-section') {
                DOM.playerMsgForm.style.display = 'block';
            }
        }

        // æ˜¾ç¤ºé”™è¯¯æç¤º
        function showError(errorId, text) {
            const errorEl = document.getElementById(errorId);
            if (errorEl) {
                errorEl.textContent = text;
                errorEl.classList.add('show');
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    errorEl.classList.remove('show');
                }, 3000);
            }
        }

        // æ¸…é™¤è¡¨å•é”™è¯¯
        function clearFormErrors(formType) {
            document.querySelectorAll(`#${formType}-form .error-message`).forEach(el => {
                el.textContent = '';
                el.classList.remove('show');
            });
        }

        // ä¿å­˜æ•°æ®åˆ°localStorageï¼ˆé˜²æŠ–ï¼‰
        const saveData = debounce(function(key) {
            localStorage.setItem(`zincEnergy${capitalizeFirstLetter(key)}`, JSON.stringify(DATA[key]));
            log(`æ•°æ®ä¿å­˜ï¼š${key}`);
        }, 300);

        // å·¥å…·å‡½æ•°ï¼šå¯†ç åŠ å¯†
        function encryptPassword(pwd) {
            // ç®€å•åŠ å¯†ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨CryptoJSç­‰æ›´å®‰å…¨çš„æ–¹å¼ï¼‰
            return btoa(pwd + CONFIG.ENCRYPT_SALT);
        }

        // å·¥å…·å‡½æ•°ï¼šç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return Date.now() + '-' + Math.floor(Math.random() * 10000);
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´æˆ³
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return `${date.getFullYear()}-${padZero(date.getMonth() + 1)}-${padZero(date.getDate())} ${padZero(date.getHours())}:${padZero(date.getMinutes())}`;
        }

        // å·¥å…·å‡½æ•°ï¼šè¡¥é›¶
        function padZero(num) {
            return num < 10 ? '0' + num : num;
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(size) {
            if (size < 1024) return size + 'B';
            if (size < 1024 * 1024) return (size / 1024).toFixed(1) + 'KB';
            return (size / 1024 / 1024).toFixed(2) + 'MB';
        }

        // å·¥å…·å‡½æ•°ï¼šé¦–å­—æ¯å¤§å†™
        function capitalizeFirstLetter(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // å·¥å…·å‡½æ•°ï¼šé˜²æŠ–
        function debounce(func, delay) {
            let timer = null;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }
    </script>
</body>
</html>